<style>
    [v-cloak] {
        display: none;
    }

    /** Fix up the alignment of the checkbox **/
    .device .checkbox {
        display: flex;
        align-items: center;
        justify-content: center;
    }

</style>

<script src='../../../assets/scripts/vue-2.5.21.min.js'></script>

<script>

    $('#hy-overlay-loading').children('.fas').attr('class', 'fas fa-circle-notch fa2x fa-spin')


    Homey.setTitle('Select the capabilities');
    Homey.showLoadingOverlay();
    Homey.emit('capabilities.initialised', null, function (err, result) {
        if (err) {
            console.log(err);
            return;
        }
        new Vue({
            el: '#app',
            data: {
                capabilities: result,
                i18n: Homey.getLanguage(function (err, result) {
                    return (err) ? 'en' : result;
                }),
                selectedCapabilities: []
            },
            methods: {
                getTitle(value, i18n) {
                    // Future proofing for new languages
                    if (value.title.hasOwnProperty(i18n)) {
                        return value.title[i18n];
                    } else {
                        return value.title.en;
                    }
                }
            },
            mounted() {
                this.$nextTick(function () {
                    Homey.hideLoadingOverlay();
                })
            },
            watch: {
                'selectedCapabilities': function (val) {
                    Homey.emit('capabilities.changed', {'capabilities': val}, function (err, result) {
                        if (err) {
                            console.log(err);
                            return;
                        }

                        console.log('$$$$$$$$$$$$$$$$$$$$$$$');
                        console.log(this.group.settings.capabilities);
                        console.log(this.group.settings.capabilities.length);
                        console.log('$$$$$$$$$$$$$$$$$$$$$$$');
                    });
                }
            }
        });
    });
</script>

<div id="app">
    <template v-cloak>
        <ul id="devices-list">
            <li class="device" v-for="(value, key) in capabilities">
                <label :for="key" class="name">
                    <div class="overlay"></div>
                    <span class="name" tabindex="-1">{{getTitle(value, i18n)}}</span>
                </label>
                <label :for="key" class="checkbox">
                    <input :id="key" :value="key" name="device" type="checkbox" tabindex="2" v-model="selectedCapabilities">
                </label>
            </li>
        </ul>
    </template>
</div>
